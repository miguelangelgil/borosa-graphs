<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deuda Soberana / PIB por Pa√≠s</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #030712; }
    .custom-scrollbar::-webkit-scrollbar { width: 8px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #1f2937; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@18.2.0",
      "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
      "recharts": "https://esm.sh/recharts@2.10.3?external=react"
    }
  }
  </script>

  <script type="module">
    import React, { useState, useEffect } from 'react';
    import { createRoot } from 'react-dom/client';
    import { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, Cell, ReferenceLine } from 'recharts';

    const regionColors = {
      "Asia": "#f59e0b",
      "Europa": "#3b82f6",
      "Am√©rica": "#10b981",
      "Latam": "#8b5cf6",
      "MENA": "#ef4444",
      "√Åfrica": "#6b7280",
      "Ocean√≠a": "#06b6d4"
    };

    function App() {
      const [imfData, setImfData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [filter, setFilter] = useState("all");
      const [sortBy, setSortBy] = useState("debt");
      const [year, setYear] = useState("2025");

      useEffect(() => {
        fetch('./data/imf_debt_data.json')
          .then(res => {
            if (!res.ok) throw new Error('No se encontr√≥ el archivo de datos');
            return res.json();
          })
          .then(data => {
            setImfData(data);
            if (data.metadata?.available_years?.[0]) {
              setYear(data.metadata.available_years[0]);
            }
            setLoading(false);
          })
          .catch(err => {
            setError(err.message);
            setLoading(false);
          });
      }, []);

      if (loading) {
        return React.createElement('div', {className: "bg-gray-950 text-white p-8 min-h-screen flex items-center justify-center"},
          React.createElement('div', {className: "text-center"},
            React.createElement('div', {className: "animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-400 mx-auto mb-4"}),
            React.createElement('p', {className: "text-gray-400"}, "Cargando datos del FMI...")
          )
        );
      }

      if (error) {
        return React.createElement('div', {className: "bg-gray-950 text-white p-8 min-h-screen flex items-center justify-center"},
          React.createElement('div', {className: "text-center max-w-md"},
            React.createElement('p', {className: "text-red-400 mb-4"}, error),
            React.createElement('p', {className: "text-gray-500 text-sm"}, "Ejecuta la GitHub Action para generar los datos.")
          )
        );
      }

      const data = imfData.data[year] || [];
      const availableYears = imfData.metadata?.available_years || [];
      const allRegions = ["all", ...new Set(data.map(d => d.region))].sort();
      
      let filtered = filter === "all" ? data : data.filter(d => d.region === filter);
      filtered = sortBy === "debt" 
        ? [...filtered].sort((a, b) => b.debt - a.debt) 
        : [...filtered].sort((a, b) => a.country.localeCompare(b.country));

      const avgDebt = data.length ? Math.round(data.reduce((sum, d) => sum + d.debt, 0) / data.length) : 0;

      const CustomTooltip = ({ active, payload }) => {
        if (active && payload && payload.length) {
          const d = payload[0].payload;
          return React.createElement('div', {className: "bg-gray-900 border border-gray-700 p-3 rounded shadow-lg"},
            React.createElement('p', {className: "font-semibold text-white"}, d.country),
            React.createElement('p', {className: "text-gray-300"}, 
              "Deuda/PIB: ", 
              React.createElement('span', {className: "text-yellow-400 font-bold"}, d.debt + "%")
            ),
            React.createElement('p', {className: "text-gray-400 text-sm"}, d.region)
          );
        }
        return null;
      };

      return React.createElement('div', {className: "bg-gray-950 text-white p-4 min-h-screen custom-scrollbar"},
        React.createElement('h1', {className: "text-2xl font-bold mb-1"}, `üìä Ratio Deuda Soberana / PIB (${year})`),
        React.createElement('p', {className: "text-gray-400 text-sm mb-4"}, 
          `Fuente: FMI DataMapper ¬∑ ${data.length} pa√≠ses ¬∑ Media: ${avgDebt}% ¬∑ Actualizado: ${imfData.metadata?.fetched_at?.split('T')[0] || 'N/A'}`
        ),
        
        // Filtros
        React.createElement('div', {className: "flex gap-4 mb-4 flex-wrap"},
          React.createElement('div', null,
            React.createElement('label', {className: "text-sm text-gray-400 mr-2"}, "A√±o:"),
            React.createElement('select', {
              value: year,
              onChange: e => setYear(e.target.value),
              className: "bg-gray-800 border border-gray-700 rounded px-2 py-1 text-sm"
            }, availableYears.map(y => React.createElement('option', {key: y, value: y}, y)))
          ),
          React.createElement('div', null,
            React.createElement('label', {className: "text-sm text-gray-400 mr-2"}, "Regi√≥n:"),
            React.createElement('select', {
              value: filter,
              onChange: e => setFilter(e.target.value),
              className: "bg-gray-800 border border-gray-700 rounded px-2 py-1 text-sm"
            }, allRegions.map(r => React.createElement('option', {key: r, value: r}, r === "all" ? "Todas" : r)))
          ),
          React.createElement('div', null,
            React.createElement('label', {className: "text-sm text-gray-400 mr-2"}, "Ordenar:"),
            React.createElement('select', {
              value: sortBy,
              onChange: e => setSortBy(e.target.value),
              className: "bg-gray-800 border border-gray-700 rounded px-2 py-1 text-sm"
            },
              React.createElement('option', {value: "debt"}, "Por deuda"),
              React.createElement('option', {value: "alpha"}, "Alfab√©tico")
            )
          )
        ),

        // Leyenda
        React.createElement('div', {className: "flex gap-3 mb-4 flex-wrap text-xs"},
          Object.entries(regionColors).map(([region, color]) =>
            React.createElement('span', {key: region, className: "flex items-center gap-1"},
              React.createElement('span', {className: "w-3 h-3 rounded", style: {backgroundColor: color}}),
              region
            )
          )
        ),

        // Gr√°fico
        React.createElement(ResponsiveContainer, {width: "100%", height: filtered.length * 22 + 40},
          React.createElement(BarChart, {data: filtered, layout: "vertical", margin: {left: 100, right: 40, top: 10, bottom: 10}},
            React.createElement(XAxis, {type: "number", domain: [0, 'auto'], tick: {fill: '#9ca3af', fontSize: 11}, tickFormatter: v => `${v}%`}),
            React.createElement(YAxis, {type: "category", dataKey: "country", tick: {fill: '#e5e7eb', fontSize: 10}, width: 95, interval: 0}),
            React.createElement(Tooltip, {content: React.createElement(CustomTooltip)}),
            React.createElement(ReferenceLine, {x: 60, stroke: "#22c55e", strokeDasharray: "5 5"}),
            React.createElement(ReferenceLine, {x: 100, stroke: "#fbbf24", strokeDasharray: "5 5"}),
            React.createElement(Bar, {dataKey: "debt", radius: [0, 4, 4, 0]},
              filtered.map((entry, index) => 
                React.createElement(Cell, {key: index, fill: regionColors[entry.region] || "#888"})
              )
            )
          )
        ),
        
        // Footer
        React.createElement('div', {className: "mt-4 text-xs text-gray-500 space-y-1"},
          React.createElement('p', null, "‚Ä¢ L√≠nea verde: 60% (l√≠mite Pacto Estabilidad UE)"),
          React.createElement('p', null, "‚Ä¢ L√≠nea amarilla: 100% del PIB"),
          React.createElement('p', null, "‚Ä¢ Indicador: GGXWDG_NGDP (Deuda bruta gobierno general)")
        ),
        React.createElement('footer', {className: "mt-8 pt-4 border-t border-gray-800 text-xs text-gray-600"},
          React.createElement('p', null, 
            "Datos actualizados autom√°ticamente v√≠a GitHub Actions ¬∑ ",
            React.createElement('a', {href: "https://github.com/miguelangelgil/borosa-graphs", className: "text-blue-500 hover:underline"}, "Ver repositorio")
          )
        )
      );
    }

    const root = createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>