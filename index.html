<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deuda Soberana / PIB por PaÃ­s</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.10.3/Recharts.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #030712; }
    .custom-scrollbar::-webkit-scrollbar { width: 8px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #1f2937; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, Cell, ReferenceLine } = Recharts;

    const regionColors = {
      "Asia": "#f59e0b",
      "Europa": "#3b82f6",
      "AmÃ©rica": "#10b981",
      "Latam": "#8b5cf6",
      "MENA": "#ef4444",
      "Ãfrica": "#6b7280",
      "OceanÃ­a": "#06b6d4"
    };

    function App() {
      const [imfData, setImfData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [filter, setFilter] = useState("all");
      const [sortBy, setSortBy] = useState("debt");
      const [year, setYear] = useState("2025");

      useEffect(() => {
        fetch('./data/imf_debt_data.json')
          .then(res => {
            if (!res.ok) throw new Error('No se encontrÃ³ el archivo de datos');
            return res.json();
          })
          .then(data => {
            setImfData(data);
            if (data.metadata?.available_years?.[0]) {
              setYear(data.metadata.available_years[0]);
            }
            setLoading(false);
          })
          .catch(err => {
            setError(err.message);
            setLoading(false);
          });
      }, []);

      if (loading) {
        return (
          <div className="bg-gray-950 text-white p-8 min-h-screen flex items-center justify-center">
            <div className="text-center">
              <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-400 mx-auto mb-4"></div>
              <p className="text-gray-400">Cargando datos del FMI...</p>
            </div>
          </div>
        );
      }

      if (error) {
        return (
          <div className="bg-gray-950 text-white p-8 min-h-screen flex items-center justify-center">
            <div className="text-center max-w-md">
              <p className="text-red-400 mb-4">{error}</p>
              <p className="text-gray-500 text-sm">Ejecuta el script Python para generar los datos.</p>
            </div>
          </div>
        );
      }

      const data = imfData.data[year] || [];
      const availableYears = imfData.metadata?.available_years || [];
      const allRegions = ["all", ...new Set(data.map(d => d.region))].sort();
      
      let filtered = filter === "all" ? data : data.filter(d => d.region === filter);
      filtered = sortBy === "debt" 
        ? [...filtered].sort((a, b) => b.debt - a.debt) 
        : [...filtered].sort((a, b) => a.country.localeCompare(b.country));

      const avgDebt = data.length ? Math.round(data.reduce((sum, d) => sum + d.debt, 0) / data.length) : 0;

      const CustomTooltip = ({ active, payload }) => {
        if (active && payload && payload.length) {
          const d = payload[0].payload;
          return (
            <div className="bg-gray-900 border border-gray-700 p-3 rounded shadow-lg">
              <p className="font-semibold text-white">{d.country}</p>
              <p className="text-gray-300">Deuda/PIB: <span className="text-yellow-400 font-bold">{d.debt}%</span></p>
              <p className="text-gray-400 text-sm">{d.region}</p>
            </div>
          );
        }
        return null;
      };

      return (
        <div className="bg-gray-950 text-white p-4 min-h-screen custom-scrollbar">
          <h1 className="text-2xl font-bold mb-1">ðŸ“Š Ratio Deuda Soberana / PIB ({year})</h1>
          <p className="text-gray-400 text-sm mb-4">
            Fuente: FMI DataMapper Â· {data.length} paÃ­ses Â· Media: {avgDebt}% Â· 
            Actualizado: {imfData.metadata?.fetched_at?.split('T')[0] || 'N/A'}
          </p>
          
          <div className="flex gap-4 mb-4 flex-wrap">
            <div>
              <label className="text-sm text-gray-400 mr-2">AÃ±o:</label>
              <select 
                value={year} 
                onChange={e => setYear(e.target.value)}
                className="bg-gray-800 border border-gray-700 rounded px-2 py-1 text-sm"
              >
                {availableYears.map(y => (
                  <option key={y} value={y}>{y}</option>
                ))}
              </select>
            </div>
            <div>
              <label className="text-sm text-gray-400 mr-2">RegiÃ³n:</label>
              <select 
                value={filter} 
                onChange={e => setFilter(e.target.value)}
                className="bg-gray-800 border border-gray-700 rounded px-2 py-1 text-sm"
              >
                {allRegions.map(r => (
                  <option key={r} value={r}>{r === "all" ? "Todas" : r}</option>
                ))}
              </select>
            </div>
            <div>
              <label className="text-sm text-gray-400 mr-2">Ordenar:</label>
              <select 
                value={sortBy} 
                onChange={e => setSortBy(e.target.value)}
                className="bg-gray-800 border border-gray-700 rounded px-2 py-1 text-sm"
              >
                <option value="debt">Por deuda</option>
                <option value="alpha">AlfabÃ©tico</option>
              </select>
            </div>
          </div>

          <div className="flex gap-3 mb-4 flex-wrap text-xs">
            {Object.entries(regionColors).map(([region, color]) => (
              <span key={region} className="flex items-center gap-1">
                <span className="w-3 h-3 rounded" style={{backgroundColor: color}}></span>
                {region}
              </span>
            ))}
          </div>

          <ResponsiveContainer width="100%" height={filtered.length * 22 + 40}>
            <BarChart data={filtered} layout="vertical" margin={{ left: 100, right: 40, top: 10, bottom: 10 }}>
              <XAxis type="number" domain={[0, 'auto']} tick={{ fill: '#9ca3af', fontSize: 11 }} tickFormatter={v => `${v}%`} />
              <YAxis type="category" dataKey="country" tick={{ fill: '#e5e7eb', fontSize: 10 }} width={95} interval={0} />
              <Tooltip content={<CustomTooltip />} />
              <ReferenceLine x={60} stroke="#22c55e" strokeDasharray="5 5" />
              <ReferenceLine x={100} stroke="#fbbf24" strokeDasharray="5 5" />
              <Bar dataKey="debt" radius={[0, 4, 4, 0]}>
                {filtered.map((entry, index) => (
                  <Cell key={index} fill={regionColors[entry.region] || "#888"} />
                ))}
              </Bar>
            </BarChart>
          </ResponsiveContainer>
          
          <div className="mt-4 text-xs text-gray-500 space-y-1">
            <p>â€¢ LÃ­nea verde: 60% (lÃ­mite Pacto Estabilidad UE)</p>
            <p>â€¢ LÃ­nea amarilla: 100% del PIB</p>
            <p>â€¢ Indicador: GGXWDG_NGDP (Deuda bruta gobierno general)</p>
          </div>

          <footer className="mt-8 pt-4 border-t border-gray-800 text-xs text-gray-600">
            <p>Datos actualizados automÃ¡ticamente vÃ­a GitHub Actions Â· 
              <a href="https://github.com/TU_USUARIO/debt-gdp-chart" className="text-blue-500 hover:underline ml-1">Ver repositorio</a>
            </p>
          </footer>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
